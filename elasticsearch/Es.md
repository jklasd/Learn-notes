今天我要分享的是关于Elasticsearch相关知识。带大家了解elasticsearch作为一个搜索服务器是怎样实现的，是怎样的一个基本原理。

P1、首先我们看到这里有4张图，这些都是我们常用的。虽然不知道他们的搜索引擎用的是不是elasticsearch，但我想说明的是我们生活中，工作中经常会用到搜索服务器。这些搜索服务器的实现原理也是相近的。



# 了解Lucene

P2、在了解Elasticsearch之前，我们先来了解一下Lucene。为什么，因为Elasticsearch是基于Lucene开发的。所以我们先来了解一下Lucene。Lucene是一个开源的全文检索引擎工具包。

它具有这几个特点：

1、稳定性、索引性能高。

* 现代硬盘上每小时可以索引150G以上的数据。

* 对内存的要求小——只需要1Mb的堆内存。

* 增量索引和批量索引一样快。

* 索引的大小约原文的20%~30%

2、高效、准确、高性能的搜索算法

* 可以做排名，最好的结果排在前面

* 多种查询方式：如短语查询，范围查询，通配符查询等等

* 支持更新操作和查询操作同时进行。

  ***

3、跨平台

纯java写的，也支持其他语言开发。



P3 搜索引擎，它要提供快速的查询功能，必须通过索引。一般搜索服务器先将采集的信息进行分析，然后建立索引。然后在用户搜索时，又对用户查询的内容进行分析，通过找到索引来找到对应内容。

而Lucene已经提供了这些功能：分词方法，索引结构，检索方法。

下面我们来理解一下搜索服务器经常会用到的一些功能。

P4 分词方法，相对于中分分词来说，英文分词相对较简单。基本的处理流程是输入文本、词汇分割、词汇过滤、词干提取、大写转小写、结果输出。

而中文分词的词与词之间并不像英文那样用空格来隔开。中文分词主要有3种分词方法：词典匹配分词法、语义理解分词法、词频统计分词法。

词典匹配分词法：把句子中从左到右扫一遍，遇到词典中有的词就标识出来，遇到复合词就找到最长的词匹配，遇到不认识的字符串则切分成单个词。

词频统计分词法：只需要对原文分析，根据两个字的统计信息，计算两个汉字的相邻共现概率，统计出来汉字之间的紧密程度。当紧密程度高于一个阈值时，便可认为这两个字可能组成词。

语义理解分词法：把分词，句法，语义分析并行进行。模拟人脑对语言和句子的理解。这个比较难实现。



P5 倒序索引是文档搜索中常用的一种索引结构，Lucene使用的就是倒序索引。

倒序索引的结构大致图是这样的。



P6 检索模型是判断文档内容与用户查询相关性的核心技术。

布尔检索模型：与、或、非三种逻辑运算

而概率检索模型



# 了解Elasticsearch

P7 到这里，Lucene已经实现了检索系统所需要的基本功能，那Elasticsearch作为一个搜索引擎，做了哪些事呢？

其实我们可以这么理解，把Lucene看做js，Elasticsearch看作jquery。索引的建立，和文档的搜索这些底层功能，Lucene都实现好了。但是如何更精准，就需要好的查询算法，这里就需要整合Lucene提供的检索模型。

P8 我们来看看Elasticsearch的搜索流程图。



P9 Elasticsearch有这些基本概念：

索引、类型、文档、映射、节点、集群、分片、副本、网关

Elastisearch里的索引和Lucene的索引不同，它可能是由Lucene的一个或多个索引构成的。它就相当我们数据库的一个库，而类型就相当于数据库的表。文档就相当于一条记录，映射是表的结构，里面描述了数据的属性。