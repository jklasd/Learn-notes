今天我要分享的是关于Elasticsearch相关知识。带大家了解elasticsearch作为一个搜索服务器是怎样实现的，是怎样的一个基本原理。

P1、首先我们看到这里有4张图，这些都是我们常用的。比如说我今天要点一份一碗香，你需要怎么操作呢？

比如你要等下要回趟老家了，然后要去走火车，要搜索一下去那里要多久，这时你可以搜索目的地，告诉你路线图，等等这些都用到搜索服务。而在你用这些服务之前，人家的服务器还需要做数据准备工作，从而来支持你需要的搜索服务。像Es就是这样的一个搜索服务器，做了数据准备工作，也提供了搜索服务。



# 了解Lucene

P2、在了解Elasticsearch之前，我们先来了解一下Lucene。为什么，因为Elasticsearch是基于Lucene开发的。所以先来简单了解一下Lucene。Lucene是一个开源的全文检索工具包，它提供了Es需要的各方面的功能。

它具有这几个特点：

1、稳定性、索引性能高。

* 现代硬盘上每小时可以索引150G以上的数据。

* 对内存的要求小——只需要1Mb的堆内存。

* 增量索引和批量索引一样快。

* 索引的大小约原文的20%~30%

2、高效、准确、高性能的搜索算法

* 可以做排名，最好的结果排在前面

* 多种查询方式：如短语查询，范围查询，通配符查询等等

* 支持更新操作和查询操作同时进行。

  ***

3、跨平台

纯java写的，也支持其他语言开发。



P3  了解Lucene的几个特点之后，我来看看开发一个搜索服务引擎需要哪些步骤呢？1、先建立索引，然后再提供搜索服务。建立索引，数据从哪里来呢？数据是从各个资源文件来，比如百度的数据，是从各个网页中抽取出来。这里抽取Lucene有个现成的工具TIKA。抽取数据之后，对文本进行分词，这里就要用到分词器，用各种分词算法。Apache也有现成的分词jar。通过分词之后，得到各个词项，来建立索引。Lucene对文本检索，常用的索引就是倒序索引。好，到这里。提供搜索的准备工作就已经完成了。

接下来，我们看看用搜索。用户搜索，在输入搜索内容，传给搜索服务器。服务器会对检索内容进行分词，或者通过一下其他算法进行分析。比如你输入了错别字，它可能需要进行更正。这里就会用到其他分析算法。分析之后，然后检索索引。通过评分规则获取最合适的结果，返回给用户。

而整个搜索服务器，需要的分词功能，内容抽取，索引建立，检索方法。Lucene都有提供。

下面我们来了解一下这些基本功能。

P4 分词算法，

相对于中分分词来说，英文分词相对较简单。基本的处理流程是输入文本、词汇分割、词汇过滤、词干提取、大写转小写、结果输出。可能会用到短语匹配。

而中文分词的字与字之间并不像英文那样用空格来简单隔开。

中文分词需要依赖词库，而且在词库不足的情况还需要词频统计的方法去拟补。

词典匹配分词法：把句子中从左到右扫一遍，遇到词典中有的词就标识出来，遇到复合词就找到最长的词匹配，遇到不认识的字符串则切分成单个词。这里的不认识的字符就是词库不足。

词频统计分词法：只需要对原文分析，根据两个字的统计信息，计算两个汉字的相邻共现概率，统计出来汉字之间的紧密程度。当紧密程度高于一个阈值时，便可认为这两个字可能组成词。

语义理解分词法：把分词，句法，语义分析并行进行。模拟人脑对语言和句子的理解。



P5 倒序索引是文档搜索中常用的一种索引结构

怎么来理解这个倒序索引呢？首先我们先来想想正序索引，正序索引是对每篇文章对应哪些词汇的结构，举个例子，比如我们现在要去高中课文里面找到“先天下之忧而忧，后天下之乐而乐”。你要怎么做？你要一本一本书去翻，才能找得到。而这就需要消耗时间。如果你用倒序索引呢，就是我们标记好这个句子，存在于哪本书，哪一页。这样我们查找时候，就可以很快的去找到原文。这也说明，倒序索引为文本检索提供了很大的帮助，对检索效率提高了很多。



P6 再看看看检索模型，检索模型是判断文档内容与用户查询相关性的核心技术。

布尔检索模型：与、或、非三种逻辑运算

而概率检索模型



# 了解Elasticsearch

P7 到这里，Lucene已经实现了检索系统所需要的基本功能，那Elasticsearch作为一个搜索引擎，做了哪些事呢？

其实我们可以这么理解，把Lucene看做js，Elasticsearch看作jquery。索引的建立，和文档的搜索这些底层功能，Lucene都实现好了。但是如何更精准，就需要好的查询算法，这里就需要整合Lucene提供的检索模型。



P8 我们来看看Elasticsearch的搜索流程图。



P9 Elasticsearch有这些基本概念：

索引、类型、文档、映射、节点、集群、分片、副本、网关

Elastisearch里的索引和Lucene的索引不同，它可能是由Lucene的一个或多个索引构成的。它就相当我们数据库的一个库，而类型就相当于数据库的表。文档就相当于一条记录，映射是表的结构，里面描述了数据的属性。